<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Will You Be My Valentine?</title>
  <style>
    :root {
      --pink-1: #ffd6e8;
      --pink-2: #ffc2dc;
      --pink-3: #ff9fc5;
      --rose: #ff4f91;
      --rose-dark: #d62f72;
      --gray: #b8b8c7;
      --card: rgba(255, 255, 255, 0.82);
      --text: #5c1a3f;
      --shadow: 0 20px 45px rgba(149, 35, 91, 0.18);
    }

    * { box-sizing: border-box; }

    body {
      margin: 0;
      min-height: 100vh;
      font-family: "Trebuchet MS", "Segoe UI", Tahoma, sans-serif;
      color: var(--text);
      background: linear-gradient(135deg, var(--pink-1), var(--pink-2) 45%, #ffe9f3);
      display: grid;
      place-items: center;
      overflow: hidden;
      position: relative;
    }

    .hearts {
      position: fixed;
      inset: 0;
      pointer-events: none;
      overflow: hidden;
      z-index: 0;
    }

    .heart {
      position: absolute;
      bottom: -40px;
      width: 20px;
      height: 20px;
      background: rgba(255, 79, 145, 0.25);
      transform: rotate(45deg);
      animation: floatUp linear infinite;
      border-radius: 4px;
    }

    .heart::before, .heart::after {
      content: "";
      position: absolute;
      width: 20px;
      height: 20px;
      background: inherit;
      border-radius: 50%;
    }

    .heart::before { left: -10px; top: 0; }
    .heart::after { left: 0; top: -10px; }

    @keyframes floatUp {
      0% { transform: translateY(0) rotate(45deg); opacity: 0; }
      10% { opacity: 1; }
      100% { transform: translateY(-120vh) rotate(45deg); opacity: 0; }
    }

    .card {
      width: min(92vw, 760px);
      min-height: 520px;
      background: var(--card);
      border: 1px solid rgba(255, 255, 255, 0.65);
      backdrop-filter: blur(4px);
      border-radius: 24px;
      box-shadow: var(--shadow);
      padding: 28px 24px 22px;
      position: relative;
      z-index: 2;
      overflow: hidden;
    }

    h1 {
      margin: 4px 0 6px;
      text-align: center;
      font-size: clamp(1.7rem, 3.6vw, 2.7rem);
      color: #7d1648;
    }

    .subtitle {
      margin: 0 0 20px;
      text-align: center;
      font-size: 1.05rem;
      opacity: 0.85;
    }

    .meter-wrap {
      margin: 0 auto 18px;
      max-width: 440px;
    }

    .meter-label {
      font-weight: 700;
      font-size: 0.95rem;
      margin-bottom: 8px;
      display: flex;
      justify-content: space-between;
    }

    .meter {
      width: 100%;
      height: 14px;
      background: rgba(255, 255, 255, 0.9);
      border: 1px solid rgba(125, 22, 72, 0.2);
      border-radius: 999px;
      overflow: hidden;
    }

    .meter-fill {
      width: 0%;
      height: 100%;
      background: linear-gradient(90deg, #ff8ebb, #ff4f91);
      transition: width 0.22s ease;
    }

    .tap-unlock {
      margin: 10px auto 0;
      display: block;
      border: none;
      background: #fff;
      color: #8a1e53;
      font-weight: 700;
      padding: 8px 14px;
      border-radius: 999px;
      cursor: pointer;
      box-shadow: 0 8px 18px rgba(138, 30, 83, 0.14);
    }

    .button-arena {
      position: relative;
      height: 180px;
      margin: 14px auto 8px;
      max-width: 680px;
      border-radius: 16px;
      background: rgba(255, 255, 255, 0.36);
      border: 1px dashed rgba(125, 22, 72, 0.18);
    }

    .btn {
      position: absolute;
      min-width: 140px;
      min-height: 58px;
      border: none;
      border-radius: 14px;
      font-size: 1.2rem;
      font-weight: 800;
      cursor: pointer;
      transition: transform 0.15s ease, filter 0.15s ease;
      user-select: none;
      touch-action: manipulation;
    }

    .btn:active { transform: scale(0.97); }

    #yesBtn {
      left: 20%;
      top: 50%;
      transform: translateY(-50%);
      background: linear-gradient(180deg, #ff6fab, #ff438d);
      color: white;
      box-shadow: 0 10px 22px rgba(255, 67, 141, 0.36);
    }

    #yesBtn.locked {
      background: linear-gradient(180deg, #d7d7e0, #bfbfd0);
      color: #55576c;
      cursor: not-allowed;
      box-shadow: none;
      filter: grayscale(0.1);
    }

    .lock-note {
      display: block;
      font-size: 0.72rem;
      font-weight: 700;
      margin-top: 4px;
      letter-spacing: 0.02em;
    }

    #noBtn {
      left: 62%;
      top: 50%;
      transform: translateY(-50%);
      background: white;
      color: #b31e61;
      border: 2px solid #ff4f91;
      box-shadow: 0 8px 18px rgba(255, 79, 145, 0.24);
    }

    .whoosh {
      animation: whoosh 0.18s ease;
    }

    @keyframes whoosh {
      0% { transform: translateY(-50%) scale(1); filter: blur(0); }
      35% { transform: translateY(-50%) scale(0.9); filter: blur(0.8px); }
      100% { transform: translateY(-50%) scale(1); filter: blur(0); }
    }

    .message {
      min-height: 42px;
      margin: 10px auto 0;
      max-width: 640px;
      text-align: center;
      font-size: 1.02rem;
      font-weight: 700;
      color: #84204f;
    }

    .burst {
      position: absolute;
      inset: 0;
      pointer-events: none;
      overflow: hidden;
    }

    .burst i {
      position: absolute;
      font-style: normal;
      font-size: 1.15rem;
      animation: burstUp 0.9s ease forwards;
      opacity: 0;
    }

    @keyframes burstUp {
      0% { transform: translateY(0) scale(0.6); opacity: 0; }
      20% { opacity: 1; }
      100% { transform: translateY(-90px) scale(1.2); opacity: 0; }
    }

    .final-screen {
      display: none;
      text-align: center;
      height: 100%;
      animation: fadeIn 0.35s ease;
    }

    .final-screen.active { display: block; }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(8px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .final-image {
      width: min(86vw, 390px);
      max-height: 62vh;
      object-fit: contain;
      border-radius: 16px;
      background: rgba(255, 255, 255, 0.82);
      box-shadow: 0 16px 36px rgba(125, 22, 72, 0.2);
    }

    .img-fallback {
      display: none;
      width: min(86vw, 390px);
      height: 420px;
      margin: 0 auto;
      border-radius: 16px;
      border: 2px dashed rgba(125, 22, 72, 0.35);
      background: rgba(255, 255, 255, 0.7);
      color: #7a204a;
      font-weight: 700;
      padding: 18px;
      align-content: center;
      text-align: center;
    }

    .final-text {
      margin: 16px 0 18px;
      font-size: clamp(1.1rem, 2.5vw, 1.45rem);
      font-weight: 800;
      color: #7f1248;
    }

    .replay {
      border: none;
      background: #fff;
      color: #8d1a53;
      font-size: 1rem;
      font-weight: 800;
      padding: 12px 20px;
      border-radius: 999px;
      cursor: pointer;
      box-shadow: 0 10px 20px rgba(125, 22, 72, 0.17);
    }

    @media (max-width: 640px) {
      .card { min-height: 560px; padding: 22px 14px 18px; }
      .button-arena { height: 200px; }
      .btn { min-width: 118px; min-height: 54px; font-size: 1.08rem; }
      #yesBtn { left: 12%; }
      #noBtn { left: 58%; }
    }
  </style>
</head>
<body>
  <div class="hearts" aria-hidden="true">
    <span class="heart" style="left:8%; animation-duration:8.5s; animation-delay:0s;"></span>
    <span class="heart" style="left:18%; animation-duration:11s; animation-delay:1.1s;"></span>
    <span class="heart" style="left:32%; animation-duration:9.2s; animation-delay:2.5s;"></span>
    <span class="heart" style="left:47%; animation-duration:10.8s; animation-delay:0.7s;"></span>
    <span class="heart" style="left:63%; animation-duration:9.8s; animation-delay:1.9s;"></span>
    <span class="heart" style="left:78%; animation-duration:12s; animation-delay:2.2s;"></span>
    <span class="heart" style="left:90%; animation-duration:8.8s; animation-delay:1.3s;"></span>
  </div>

  <main class="card" id="card">
    <section id="startScreen">
      <h1>Will you be my Valentine?</h1>
      <p class="subtitle">Choose wisely.</p>

      <div class="meter-wrap">
        <div class="meter-label">
          <span>Unlock Yes</span>
          <span id="meterPercent">0%</span>
        </div>
        <div class="meter" aria-label="Unlock Yes meter" role="progressbar" aria-valuemin="0" aria-valuemax="100" aria-valuenow="0">
          <div class="meter-fill" id="meterFill"></div>
        </div>
        <button class="tap-unlock" id="tapUnlock" type="button">Tap to unlock</button>
      </div>

      <div class="button-arena" id="buttonArena">
        <button class="btn locked" id="yesBtn" type="button" disabled>
          Yes
          <span class="lock-note">ðŸ”’ Locked</span>
        </button>
        <button class="btn" id="noBtn" type="button">No</button>
      </div>

      <p class="message" id="messageArea">Tap around to fill the heart meter.</p>
      <div class="burst" id="burstLayer" aria-hidden="true"></div>
    </section>

    <section class="final-screen" id="finalScreen">
      <img id="finalImage" class="final-image" alt="Me giving flowers" />
      <div id="imgFallback" class="img-fallback">
        Couldnâ€™t load image.<br /><br />
        Place <strong>me-flowers.png</strong> next to <strong>index.html</strong><br />
        or replace the fallback data URL in the script.
      </div>
      <p class="final-text">sorry for taking so long, I love you</p>
      <button class="replay" id="replayBtn" type="button">Replay</button>
    </section>
  </main>

  <script>
    // Replace this with your own PNG data URL if you want to embed directly.
    const FALLBACK_DATA_URL = "data:image/png;base64,REPLACE_WITH_BASE64_PNG";

    const MAX_TAPS = 6;
    let taps = 0;
    let noMoveCooldown = 0;
    let fallbackUsed = false;

    const card = document.getElementById("card");
    const startScreen = document.getElementById("startScreen");
    const finalScreen = document.getElementById("finalScreen");
    const arena = document.getElementById("buttonArena");
    const yesBtn = document.getElementById("yesBtn");
    const noBtn = document.getElementById("noBtn");
    const tapUnlock = document.getElementById("tapUnlock");
    const meterFill = document.getElementById("meterFill");
    const meterPercent = document.getElementById("meterPercent");
    const messageArea = document.getElementById("messageArea");
    const burstLayer = document.getElementById("burstLayer");
    const finalImage = document.getElementById("finalImage");
    const imgFallback = document.getElementById("imgFallback");
    const replayBtn = document.getElementById("replayBtn");
    const meterEl = document.querySelector(".meter");

    const tapMessages = [
      "Nice. Heart fuel added.",
      "Patience level: adorable.",
      "You are suspiciously committed.",
      "Almost there. Keep tapping!",
      "Thatâ€™s basically true love energy.",
      "Lock is panicking..."
    ];

    function setMessage(text) {
      messageArea.textContent = text;
    }

    function updateMeter() {
      const pct = Math.min(100, Math.round((taps / MAX_TAPS) * 100));
      meterFill.style.width = pct + "%";
      meterPercent.textContent = pct + "%";
      meterEl.setAttribute("aria-valuenow", String(pct));
    }

    function unlockYes() {
      yesBtn.disabled = false;
      yesBtn.classList.remove("locked");
      yesBtn.querySelector(".lock-note").textContent = "âœ… Unlocked";
      setMessage("Ok, you unlocked Yes. Now click it.");
      celebrate();
    }

    function addProgress() {
      if (taps >= MAX_TAPS) return;
      taps += 1;
      updateMeter();
      setMessage(tapMessages[Math.min(taps - 1, tapMessages.length - 1)]);
      if (taps >= MAX_TAPS) unlockYes();
    }

    function rectOverlap(a, b) {
      return !(a.right < b.left || a.left > b.right || a.bottom < b.top || a.top > b.bottom);
    }

    function placeNoButtonRandom() {
      const aRect = arena.getBoundingClientRect();
      const yesRect = yesBtn.getBoundingClientRect();
      const nRect = noBtn.getBoundingClientRect();

      const pad = 8;
      const maxLeft = aRect.width - nRect.width - pad;
      const maxTop = aRect.height - nRect.height - pad;

      if (maxLeft <= pad || maxTop <= pad) return;

      for (let i = 0; i < 60; i++) {
        const left = Math.random() * (maxLeft - pad) + pad;
        const top = Math.random() * (maxTop - pad) + pad;

        const candidate = {
          left: aRect.left + left,
          top: aRect.top + top,
          right: aRect.left + left + nRect.width,
          bottom: aRect.top + top + nRect.height
        };

        if (!rectOverlap(candidate, yesRect)) {
          noBtn.style.left = left + "px";
          noBtn.style.top = top + "px";
          noBtn.classList.remove("whoosh");
          void noBtn.offsetWidth;
          noBtn.classList.add("whoosh");
          return;
        }
      }
    }

    function pointToRectDistance(x, y, rect) {
      const dx = Math.max(rect.left - x, 0, x - rect.right);
      const dy = Math.max(rect.top - y, 0, y - rect.bottom);
      return Math.hypot(dx, dy);
    }

    function tryDodge() {
      const now = Date.now();
      if (now - noMoveCooldown < 110) return;
      noMoveCooldown = now;
      placeNoButtonRandom();
    }

    function onArenaMove(e) {
      const noRect = noBtn.getBoundingClientRect();
      if (pointToRectDistance(e.clientX, e.clientY, noRect) < 80) {
        tryDodge();
      }
    }

    function celebrate() {
      const hearts = ["ðŸ’–", "ðŸ’•", "ðŸ’˜", "ðŸ’—", "ðŸ’“"];
      for (let i = 0; i < 10; i++) {
        const el = document.createElement("i");
        el.textContent = hearts[i % hearts.length];
        el.style.left = 20 + Math.random() * 60 + "%";
        el.style.bottom = 24 + Math.random() * 22 + "%";
        el.style.animationDelay = (Math.random() * 0.2) + "s";
        burstLayer.appendChild(el);
        setTimeout(() => el.remove(), 1000);
      }
    }

    function showFinalScreen() {
      startScreen.style.display = "none";
      finalScreen.classList.add("active");
      loadFinalImage();
    }

    function loadFinalImage() {
      fallbackUsed = false;
      finalImage.style.display = "block";
      imgFallback.style.display = "none";

      finalImage.onload = () => {
        finalImage.style.display = "block";
        imgFallback.style.display = "none";
      };

      finalImage.onerror = () => {
        const hasValidFallback = FALLBACK_DATA_URL.startsWith("data:image/") &&
          !FALLBACK_DATA_URL.includes("REPLACE_WITH_BASE64_PNG");
        if (!fallbackUsed && hasValidFallback) {
          fallbackUsed = true;
          finalImage.src = FALLBACK_DATA_URL;
          return;
        }
        finalImage.style.display = "none";
        imgFallback.style.display = "block";
      };

      // Preferred option: local file in same folder as index.html
      finalImage.src = "me-flowers.png";
    }

    function resetNoPosition() {
      noBtn.style.left = "62%";
      noBtn.style.top = "50%";
    }

    function resetGame() {
      taps = 0;
      updateMeter();
      yesBtn.disabled = true;
      yesBtn.classList.add("locked");
      yesBtn.querySelector(".lock-note").textContent = "ðŸ”’ Locked";
      setMessage("Tap around to fill the heart meter.");
      startScreen.style.display = "block";
      finalScreen.classList.remove("active");
      resetNoPosition();
    }

    // Unlock taps (card clicks)
    card.addEventListener("click", (e) => {
      if (startScreen.style.display === "none") return;
      if (e.target === noBtn) return;
      if (!yesBtn.disabled && e.target === yesBtn) return;
      if (e.target === tapUnlock) return;
      addProgress();
    });

    tapUnlock.addEventListener("click", (e) => {
      e.stopPropagation();
      addProgress();
    });

    yesBtn.addEventListener("click", () => {
      if (yesBtn.disabled) return;
      showFinalScreen();
    });

    noBtn.addEventListener("mouseenter", tryDodge);
    noBtn.addEventListener("click", (e) => {
      e.preventDefault();
      setMessage("Nice try.");
      tryDodge();
    });

    // Desktop proximity dodge
    arena.addEventListener("mousemove", onArenaMove);

    // Mobile: dodge on touch near button or direct tap
    arena.addEventListener("touchstart", (e) => {
      if (!e.touches || !e.touches[0]) return;
      const t = e.touches[0];
      const noRect = noBtn.getBoundingClientRect();
      if (pointToRectDistance(t.clientX, t.clientY, noRect) < 90) {
        e.preventDefault();
        tryDodge();
      }
    }, { passive: false });

    noBtn.addEventListener("touchstart", (e) => {
      e.preventDefault();
      setMessage("Nope. That button has commitment issues.");
      tryDodge();
    }, { passive: false });

    replayBtn.addEventListener("click", resetGame);
    window.addEventListener("resize", resetNoPosition);

    // Initial state
    updateMeter();
    resetNoPosition();
  </script>
</body>
</html>
